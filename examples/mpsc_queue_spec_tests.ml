(* This file is generated by ortac qcheck-stm,
   edit how you run the tool instead *)
[@@@ocaml.warning "-26-27-69-32-34-38"]
open Mpsc_queue_spec
module Ortac_runtime = Ortac_runtime_qcheck_stm_domain
let is_empty_1 q =
  try q = Ortac_runtime.Gospelstdlib.Sequence.empty
  with
  | e ->
      raise
        (Ortac_runtime.Partial_function
           (e,
             {
               Ortac_runtime.start =
                 {
                   pos_fname = "mpsc_queue_spec.mli";
                   pos_lnum = 15;
                   pos_bol = 628;
                   pos_cnum = 671
                 };
               Ortac_runtime.stop =
                 {
                   pos_fname = "mpsc_queue_spec.mli";
                   pos_lnum = 15;
                   pos_bol = 628;
                   pos_cnum = 680
                 }
             }))
let apply_if_not cond f a_1 =
  try if cond = true then a_1 else f a_1
  with
  | e ->
      raise
        (Ortac_runtime.Partial_function
           (e,
             {
               Ortac_runtime.start =
                 {
                   pos_fname = "mpsc_queue_spec.mli";
                   pos_lnum = 18;
                   pos_bol = 877;
                   pos_cnum = 883
                 };
               Ortac_runtime.stop =
                 {
                   pos_fname = "mpsc_queue_spec.mli";
                   pos_lnum = 18;
                   pos_bol = 877;
                   pos_cnum = 906
                 }
             }))
let tail_safe q_1 =
  try
    if is_empty_1 q_1
    then q_1
    else Ortac_runtime.Gospelstdlib.Sequence.tl q_1
  with
  | e ->
      raise
        (Ortac_runtime.Partial_function
           (e,
             {
               Ortac_runtime.start =
                 {
                   pos_fname = "mpsc_queue_spec.mli";
                   pos_lnum = 21;
                   pos_bol = 1066;
                   pos_cnum = 1072
                 };
               Ortac_runtime.stop =
                 {
                   pos_fname = "mpsc_queue_spec.mli";
                   pos_lnum = 21;
                   pos_bol = 1066;
                   pos_cnum = 1102
                 }
             }))
let head_safe q_2 =
  try
    if is_empty_1 q_2
    then None
    else Some (Ortac_runtime.Gospelstdlib.Sequence.hd q_2)
  with
  | e ->
      raise
        (Ortac_runtime.Partial_function
           (e,
             {
               Ortac_runtime.start =
                 {
                   pos_fname = "mpsc_queue_spec.mli";
                   pos_lnum = 24;
                   pos_bol = 1267;
                   pos_cnum = 1273
                 };
               Ortac_runtime.stop =
                 {
                   pos_fname = "mpsc_queue_spec.mli";
                   pos_lnum = 24;
                   pos_bol = 1267;
                   pos_cnum = 1313
                 }
             }))
module SUT =
  (Ortac_runtime.SUT.Make)(struct type sut = int t
                                  let init () = create () end)
module ModelElt =
  struct
    type nonrec elt =
      {
      contents: int Ortac_runtime.Gospelstdlib.sequence ;
      closed: bool }
    let init =
      let () = () in
      {
        contents =
          (try Ortac_runtime.Gospelstdlib.Sequence.empty
           with
           | e ->
               raise
                 (Ortac_runtime.Partial_function
                    (e,
                      {
                        Ortac_runtime.start =
                          {
                            pos_fname = "mpsc_queue_spec.mli";
                            pos_lnum = 36;
                            pos_bol = 2068;
                            pos_cnum = 2093
                          };
                        Ortac_runtime.stop =
                          {
                            pos_fname = "mpsc_queue_spec.mli";
                            pos_lnum = 36;
                            pos_bol = 2068;
                            pos_cnum = 2098
                          }
                      })));
        closed =
          (try false
           with
           | e ->
               raise
                 (Ortac_runtime.Partial_function
                    (e,
                      {
                        Ortac_runtime.start =
                          {
                            pos_fname = "mpsc_queue_spec.mli";
                            pos_lnum = 37;
                            pos_bol = 2099;
                            pos_cnum = 2122
                          };
                        Ortac_runtime.stop =
                          {
                            pos_fname = "mpsc_queue_spec.mli";
                            pos_lnum = 37;
                            pos_bol = 2099;
                            pos_cnum = 2127
                          }
                      })))
      }
  end
module Model = (Ortac_runtime.Model.Make)(ModelElt)
module Spec =
  struct
    open STM
    module QCheck =
      struct
        include QCheck
        module Gen = struct include Gen
                            let int = nat
                            let list = small_list end
      end
    type _ ty +=  
      | Integer: Ortac_runtime.integer ty 
    let integer = (Integer, Ortac_runtime.string_of_integer)
    type _ ty +=  
      | SUT: SUT.elt ty 
    let sut = (SUT, (fun _ -> "<sut>"))
    type sut = SUT.t
    let init_sut = SUT.create 1
    type state = Model.t
    let init_state = Model.create 1 ()
    type cmd =
      | Create of unit 
      | Of_list of int list 
      | Push of int 
      | Push_all of int list 
      | Is_empty 
      | Close 
      | Pop_exn 
      | Pop_opt 
      | Drop_exn 
      | Peek_exn 
      | Peek_opt 
      | Push_head of int 
    let show_cmd cmd__001_ =
      match cmd__001_ with
      | Create () ->
          Format.asprintf "%s %a" "create" (Util.Pp.pp_unit true) ()
      | Of_list xs ->
          Format.asprintf "%s %a" "of_list"
            (Util.Pp.pp_list Util.Pp.pp_int true) xs
      | Push a_2 ->
          Format.asprintf "protect (fun () -> %s <sut> %a)" "push"
            (Util.Pp.pp_int true) a_2
      | Push_all xs_1 ->
          Format.asprintf "protect (fun () -> %s <sut> %a)" "push_all"
            (Util.Pp.pp_list Util.Pp.pp_int true) xs_1
      | Is_empty -> Format.asprintf "protect (fun () -> %s <sut>)" "is_empty"
      | Close -> Format.asprintf "protect (fun () -> %s <sut>)" "close"
      | Pop_exn -> Format.asprintf "protect (fun () -> %s <sut>)" "pop_exn"
      | Pop_opt -> Format.asprintf "protect (fun () -> %s <sut>)" "pop_opt"
      | Drop_exn -> Format.asprintf "protect (fun () -> %s <sut>)" "drop_exn"
      | Peek_exn -> Format.asprintf "protect (fun () -> %s <sut>)" "peek_exn"
      | Peek_opt -> Format.asprintf "protect (fun () -> %s <sut>)" "peek_opt"
      | Push_head a_3 ->
          Format.asprintf "protect (fun () -> %s <sut> %a)" "push_head"
            (Util.Pp.pp_int true) a_3
    let cleanup _ = ()
    let arb_cmd _ =
      let open QCheck in
        make ~print:show_cmd
          (let open Gen in
             frequency
               [(1, ((pure (fun () -> Create ())) <*> unit));
               (1,
                 ((pure (fun xs -> Of_list xs)) <*> (list small_signed_int)));
               (1, ((pure (fun a_2 -> Push a_2)) <*> int));
               (1, ((pure (fun xs_1 -> Push_all xs_1)) <*> (list int)));
               (1, (pure Is_empty));
               (1, (pure Close));
               (1, (pure Pop_exn));
               (1, (pure Pop_opt));
               (1, (pure Drop_exn));
               (1, (pure Peek_exn));
               (1, (pure Peek_opt));
               (1, ((pure (fun a_3 -> Push_head a_3)) <*> int))])
    let arb_cmd_seq = arb_cmd
    let arb_cmd_dom0 = arb_cmd
    let arb_cmd_dom1 = arb_cmd
    let next_state cmd__002_ state__003_ =
      match cmd__002_ with
      | Create () ->
          let q_3__005_ =
            let open ModelElt in
              {
                contents =
                  (try Ortac_runtime.Gospelstdlib.Sequence.empty
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 36;
                                    pos_bol = 2068;
                                    pos_cnum = 2093
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 36;
                                    pos_bol = 2068;
                                    pos_cnum = 2098
                                  }
                              })));
                closed =
                  (try false
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 37;
                                    pos_bol = 2099;
                                    pos_cnum = 2122
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 37;
                                    pos_bol = 2099;
                                    pos_cnum = 2127
                                  }
                              })))
              } in
          Model.drop_n state__003_ 0
      | Of_list xs ->
          let q_4__007_ =
            let open ModelElt in
              {
                contents =
                  (try Ortac_runtime.Gospelstdlib.List.to_seq xs
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 58;
                                    pos_bol = 2789;
                                    pos_cnum = 2814
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 58;
                                    pos_bol = 2789;
                                    pos_cnum = 2828
                                  }
                              })));
                closed =
                  (try false
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 59;
                                    pos_bol = 2829;
                                    pos_cnum = 2852
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 59;
                                    pos_bol = 2829;
                                    pos_cnum = 2857
                                  }
                              })))
              } in
          Model.drop_n state__003_ 0
      | Push a_2 ->
          let q_5__008_ = Model.get state__003_ 0 in
          let q_5__009_ =
            let open ModelElt in
              {
                q_5__008_ with
                contents =
                  (try
                     apply_if_not q_5__008_.closed
                       (fun seq ->
                          Ortac_runtime.Gospelstdlib.Sequence.snoc seq a_2)
                       q_5__008_.contents
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 72;
                                    pos_bol = 3398;
                                    pos_cnum = 3404
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 72;
                                    pos_bol = 3398;
                                    pos_cnum = 3416
                                  }
                              })))
              } in
          Model.push (Model.drop_n state__003_ 1) q_5__009_
      | Push_all xs_1 ->
          let q_6__010_ = Model.get state__003_ 0 in
          let q_6__011_ =
            let open ModelElt in
              {
                q_6__010_ with
                contents =
                  (try
                     apply_if_not q_6__010_.closed
                       (fun seq_1 ->
                          Ortac_runtime.Gospelstdlib.(++) seq_1
                            (Ortac_runtime.Gospelstdlib.List.to_seq xs_1))
                       q_6__010_.contents
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 107;
                                    pos_bol = 4511;
                                    pos_cnum = 4517
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 107;
                                    pos_bol = 4511;
                                    pos_cnum = 4529
                                  }
                              })))
              } in
          Model.push (Model.drop_n state__003_ 1) q_6__011_
      | Is_empty ->
          let q_7__012_ = Model.get state__003_ 0 in
          let q_7__013_ = q_7__012_ in
          Model.push (Model.drop_n state__003_ 1) q_7__013_
      | Close ->
          let q_8__014_ = Model.get state__003_ 0 in
          let q_8__015_ =
            let open ModelElt in
              {
                q_8__014_ with
                closed =
                  (try true
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 135;
                                    pos_bol = 5822;
                                    pos_cnum = 5845
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 135;
                                    pos_bol = 5822;
                                    pos_cnum = 5849
                                  }
                              })))
              } in
          Model.push (Model.drop_n state__003_ 1) q_8__015_
      | Pop_exn ->
          let q_9__016_ = Model.get state__003_ 0 in
          let q_9__017_ =
            let open ModelElt in
              {
                q_9__016_ with
                contents =
                  (try
                     apply_if_not
                       (if
                          (q_9__016_.closed = true) &&
                            (is_empty_1 q_9__016_.contents)
                        then true
                        else false) tail_safe q_9__016_.contents
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 148;
                                    pos_bol = 6397;
                                    pos_cnum = 6403
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 148;
                                    pos_bol = 6397;
                                    pos_cnum = 6415
                                  }
                              })))
              } in
          Model.push (Model.drop_n state__003_ 1) q_9__017_
      | Pop_opt ->
          let q_10__018_ = Model.get state__003_ 0 in
          let q_10__019_ =
            let open ModelElt in
              {
                q_10__018_ with
                contents =
                  (try
                     apply_if_not
                       (if
                          (q_10__018_.closed = true) &&
                            (is_empty_1 q_10__018_.contents)
                        then true
                        else false) tail_safe q_10__018_.contents
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 164;
                                    pos_bol = 7198;
                                    pos_cnum = 7204
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 164;
                                    pos_bol = 7198;
                                    pos_cnum = 7216
                                  }
                              })))
              } in
          Model.push (Model.drop_n state__003_ 1) q_10__019_
      | Drop_exn ->
          let q_11__020_ = Model.get state__003_ 0 in
          let q_11__021_ =
            let open ModelElt in
              {
                q_11__020_ with
                contents =
                  (try
                     apply_if_not
                       (if
                          (q_11__020_.closed = true) &&
                            (is_empty_1 q_11__020_.contents)
                        then true
                        else false) tail_safe q_11__020_.contents
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 181;
                                    pos_bol = 7931;
                                    pos_cnum = 7937
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 181;
                                    pos_bol = 7931;
                                    pos_cnum = 7949
                                  }
                              })))
              } in
          Model.push (Model.drop_n state__003_ 1) q_11__021_
      | Peek_exn ->
          let q_12__022_ = Model.get state__003_ 0 in
          let q_12__023_ = q_12__022_ in
          Model.push (Model.drop_n state__003_ 1) q_12__023_
      | Peek_opt ->
          let q_13__024_ = Model.get state__003_ 0 in
          let q_13__025_ = q_13__024_ in
          Model.push (Model.drop_n state__003_ 1) q_13__025_
      | Push_head a_3 ->
          let q_14__026_ = Model.get state__003_ 0 in
          let q_14__027_ =
            let open ModelElt in
              {
                q_14__026_ with
                contents =
                  (try
                     apply_if_not
                       (if
                          (q_14__026_.closed = true) &&
                            (is_empty_1 q_14__026_.contents)
                        then true
                        else false)
                       (Ortac_runtime.Gospelstdlib.Sequence.cons a_3)
                       q_14__026_.contents
                   with
                   | e ->
                       raise
                         (Ortac_runtime.Partial_function
                            (e,
                              {
                                Ortac_runtime.start =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 218;
                                    pos_bol = 9908;
                                    pos_cnum = 9914
                                  };
                                Ortac_runtime.stop =
                                  {
                                    pos_fname = "mpsc_queue_spec.mli";
                                    pos_lnum = 218;
                                    pos_bol = 9908;
                                    pos_cnum = 9926
                                  }
                              })))
              } in
          Model.push (Model.drop_n state__003_ 1) q_14__027_
    let precond cmd__088_ state__089_ =
      match cmd__088_ with
      | Create () -> true
      | Of_list xs -> true
      | Push a_2 -> true
      | Push_all xs_1 -> true
      | Is_empty -> true
      | Close -> true
      | Pop_exn -> true
      | Pop_opt -> true
      | Drop_exn -> true
      | Peek_exn -> true
      | Peek_opt -> true
      | Push_head a_3 -> true
    let postcond _ _ _ = true
    let run cmd__090_ sut__091_ =
      match cmd__090_ with
      | Create () -> Res (sut, (let res__092_ = create () in res__092_))
      | Of_list xs -> Res (sut, (let res__093_ = of_list xs in res__093_))
      | Push a_2 ->
          Res
            ((result unit exn),
              (let q_5__094_ = SUT.get sut__091_ 0 in
               let res__095_ = protect (fun () -> push q_5__094_ a_2) () in
               res__095_))
      | Push_all xs_1 ->
          Res
            ((result unit exn),
              (let q_6__096_ = SUT.get sut__091_ 0 in
               let res__097_ = protect (fun () -> push_all q_6__096_ xs_1) () in
               res__097_))
      | Is_empty ->
          Res
            ((result bool exn),
              (let q_7__098_ = SUT.get sut__091_ 0 in
               let res__099_ = protect (fun () -> is_empty q_7__098_) () in
               res__099_))
      | Close ->
          Res
            ((result unit exn),
              (let q_8__100_ = SUT.get sut__091_ 0 in
               let res__101_ = protect (fun () -> close q_8__100_) () in
               res__101_))
      | Pop_exn ->
          Res
            ((result int exn),
              (let q_9__102_ = SUT.get sut__091_ 0 in
               let res__103_ = protect (fun () -> pop_exn q_9__102_) () in
               res__103_))
      | Pop_opt ->
          Res
            ((result (option int) exn),
              (let q_10__104_ = SUT.get sut__091_ 0 in
               let res__105_ = protect (fun () -> pop_opt q_10__104_) () in
               res__105_))
      | Drop_exn ->
          Res
            ((result unit exn),
              (let q_11__106_ = SUT.get sut__091_ 0 in
               let res__107_ = protect (fun () -> drop_exn q_11__106_) () in
               res__107_))
      | Peek_exn ->
          Res
            ((result int exn),
              (let q_12__108_ = SUT.get sut__091_ 0 in
               let res__109_ = protect (fun () -> peek_exn q_12__108_) () in
               res__109_))
      | Peek_opt ->
          Res
            ((result (option int) exn),
              (let q_13__110_ = SUT.get sut__091_ 0 in
               let res__111_ = protect (fun () -> peek_opt q_13__110_) () in
               res__111_))
      | Push_head a_3 ->
          Res
            ((result unit exn),
              (let q_14__112_ = SUT.get sut__091_ 0 in
               let res__113_ =
                 protect (fun () -> push_head q_14__112_ a_3) () in
               res__113_))
  end
module STMTests = (Ortac_runtime.Make)(Spec)
let check_init_state () = ()
let ortac_show_cmd cmd__115_ models__116_ last__118_ res__117_ =
  let open Spec in
    let open STM in
      match (cmd__115_, res__117_) with
      | (Create (), Res ((SUT, _), q_3)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = %s %a" lhs "create"
            (Util.Pp.pp_unit true) ()
      | (Of_list xs, Res ((SUT, _), q_4)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = %s %a" lhs "of_list"
            (Util.Pp.pp_list Util.Pp.pp_int true) xs
      | (Push a_2, Res ((Result (Unit, Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s %a)" lhs "push"
            (Model.get_name models__116_ (0 + shift)) (Util.Pp.pp_int true)
            a_2
      | (Push_all xs_1, Res ((Result (Unit, Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s %a)" lhs
            "push_all" (Model.get_name models__116_ (0 + shift))
            (Util.Pp.pp_list Util.Pp.pp_int true) xs_1
      | (Is_empty, Res ((Result (Bool, Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s)" lhs "is_empty"
            (Model.get_name models__116_ (0 + shift))
      | (Close, Res ((Result (Unit, Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s)" lhs "close"
            (Model.get_name models__116_ (0 + shift))
      | (Pop_exn, Res ((Result (Int, Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s)" lhs "pop_exn"
            (Model.get_name models__116_ (0 + shift))
      | (Pop_opt, Res ((Result (Option (Int), Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s)" lhs "pop_opt"
            (Model.get_name models__116_ (0 + shift))
      | (Drop_exn, Res ((Result (Unit, Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s)" lhs "drop_exn"
            (Model.get_name models__116_ (0 + shift))
      | (Peek_exn, Res ((Result (Int, Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s)" lhs "peek_exn"
            (Model.get_name models__116_ (0 + shift))
      | (Peek_opt, Res ((Result (Option (Int), Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s)" lhs "peek_opt"
            (Model.get_name models__116_ (0 + shift))
      | (Push_head a_3, Res ((Result (Unit, Exn), _), _)) ->
          let lhs = if last__118_ then "r" else "_"
          and shift = 0 in
          Format.asprintf "let %s = protect (fun () -> %s %s %a)" lhs
            "push_head" (Model.get_name models__116_ (0 + shift))
            (Util.Pp.pp_int true) a_3
      | _ -> assert false
let ortac_postcond cmd__028_ state__029_ res__030_ =
  let open Spec in
    let open STM in
      let new_state__031_ = lazy (next_state cmd__028_ state__029_) in
      match (cmd__028_, res__030_) with
      | (Create (), Res ((SUT, _), q_3)) -> None
      | (Of_list xs, Res ((SUT, _), q_4)) -> None
      | (Push a_2, Res ((Result (Unit, Exn), _), res)) ->
          (match res with
           | Ok _ -> None
           | Error (Closed) ->
               if
                 let q_old__032_ = Model.get state__029_ 0
                 and q_new__033_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try (Lazy.force q_new__033_).closed = true
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain) "push"
                      [("q.closed",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 76;
                               pos_bol = 3491;
                               pos_cnum = 3512
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 76;
                               pos_bol = 3491;
                               pos_cnum = 3520
                             }
                         })])
           | _ -> None)
      | (Push_all xs_1, Res ((Result (Unit, Exn), _), res)) ->
          (match res with
           | Ok _ -> None
           | Error (Closed) ->
               if
                 let q_old__035_ = Model.get state__029_ 0
                 and q_new__036_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try (Lazy.force q_new__036_).closed = true
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "push_all"
                      [("q.closed",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 111;
                               pos_bol = 4617;
                               pos_cnum = 4638
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 111;
                               pos_bol = 4617;
                               pos_cnum = 4646
                             }
                         })])
           | _ -> None)
      | (Is_empty, Res ((Result (Bool, Exn), _), b)) ->
          (match b with
           | Ok b ->
               if
                 let q_old__040_ = Model.get state__029_ 0
                 and q_new__041_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    (b = true) =
                      (is_empty_1 (Lazy.force q_new__041_).contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try
                         Ortac_runtime.Report.Protected_value
                           (Res
                              (bool,
                                (let q_old__038_ = Model.get state__029_ 0
                                 and q_new__039_ =
                                   lazy
                                     (Model.get (Lazy.force new_state__031_)
                                        0) in
                                 is_empty_1 (Lazy.force q_new__039_).contents)))
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "is_empty"
                      [("b = is_empty q.contents",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 124;
                               pos_bol = 5205;
                               pos_cnum = 5217
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 124;
                               pos_bol = 5205;
                               pos_cnum = 5240
                             }
                         })])
           | Error (Closed) ->
               if
                 let q_old__042_ = Model.get state__029_ 0
                 and q_new__043_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    ((Lazy.force q_new__043_).closed = true) &&
                      (is_empty_1 (Lazy.force q_new__043_).contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "is_empty"
                      [("q.closed && is_empty q.contents",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 125;
                               pos_bol = 5241;
                               pos_cnum = 5262
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 125;
                               pos_bol = 5241;
                               pos_cnum = 5293
                             }
                         })])
           | _ -> None)
      | (Close, Res ((Result (Unit, Exn), _), res)) ->
          (match res with
           | Ok _ -> None
           | Error (Closed) ->
               if
                 let q_old__045_ = Model.get state__029_ 0
                 and q_new__046_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try q_old__045_.closed = true with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "close"
                      [("old q.closed",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 136;
                               pos_bol = 5850;
                               pos_cnum = 5871
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 136;
                               pos_bol = 5850;
                               pos_cnum = 5883
                             }
                         })])
           | _ -> None)
      | (Pop_exn, Res ((Result (Int, Exn), _), a_4)) ->
          (match a_4 with
           | Ok a_4 ->
               if
                 let q_old__050_ = Model.get state__029_ 0
                 and q_new__051_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    a_4 =
                      (Ortac_runtime.Gospelstdlib.Sequence.hd
                         q_old__050_.contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try
                         Ortac_runtime.Report.Protected_value
                           (Res
                              (int,
                                (let q_old__048_ = Model.get state__029_ 0
                                 and q_new__049_ =
                                   lazy
                                     (Model.get (Lazy.force new_state__031_)
                                        0) in
                                 Ortac_runtime.Gospelstdlib.Sequence.hd
                                   q_old__048_.contents)))
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "pop_exn"
                      [("a = hd (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 152;
                               pos_bol = 6507;
                               pos_cnum = 6519
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 152;
                               pos_bol = 6507;
                               pos_cnum = 6542
                             }
                         })])
           | Error (Empty) ->
               if
                 let q_old__052_ = Model.get state__029_ 0
                 and q_new__053_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try is_empty_1 q_old__052_.contents with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Empty"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "pop_exn"
                      [("is_empty (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 153;
                               pos_bol = 6543;
                               pos_cnum = 6563
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 153;
                               pos_bol = 6543;
                               pos_cnum = 6588
                             }
                         })])
           | Error (Closed) ->
               if
                 let q_old__054_ = Model.get state__029_ 0
                 and q_new__055_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    ((Lazy.force q_new__055_).closed = true) &&
                      (is_empty_1 q_old__054_.contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "pop_exn"
                      [("q.closed && is_empty (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 154;
                               pos_bol = 6589;
                               pos_cnum = 6610
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 154;
                               pos_bol = 6589;
                               pos_cnum = 6647
                             }
                         })])
           | _ -> None)
      | (Pop_opt, Res ((Result (Option (Int), Exn), _), o)) ->
          (match o with
           | Ok o ->
               if
                 let q_old__059_ = Model.get state__029_ 0
                 and q_new__060_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try o = (head_safe q_old__059_.contents) with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try
                         Ortac_runtime.Report.Protected_value
                           (Res
                              ((option int),
                                (let q_old__057_ = Model.get state__029_ 0
                                 and q_new__058_ =
                                   lazy
                                     (Model.get (Lazy.force new_state__031_)
                                        0) in
                                 head_safe q_old__057_.contents)))
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "pop_opt"
                      [("o = head_safe (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 168;
                               pos_bol = 7302;
                               pos_cnum = 7314
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 168;
                               pos_bol = 7302;
                               pos_cnum = 7344
                             }
                         })])
           | Error (Closed) ->
               if
                 let q_old__061_ = Model.get state__029_ 0
                 and q_new__062_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    ((Lazy.force q_new__062_).closed = true) &&
                      (is_empty_1 q_old__061_.contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "pop_opt"
                      [("q.closed && is_empty (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 169;
                               pos_bol = 7345;
                               pos_cnum = 7366
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 169;
                               pos_bol = 7345;
                               pos_cnum = 7403
                             }
                         })])
           | _ -> None)
      | (Drop_exn, Res ((Result (Unit, Exn), _), res)) ->
          (match res with
           | Ok _ -> None
           | Error (Empty) ->
               if
                 let q_old__064_ = Model.get state__029_ 0
                 and q_new__065_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try is_empty_1 q_old__064_.contents with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Empty"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "drop_exn"
                      [("is_empty (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 185;
                               pos_bol = 8035;
                               pos_cnum = 8055
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 185;
                               pos_bol = 8035;
                               pos_cnum = 8080
                             }
                         })])
           | Error (Closed) ->
               if
                 let q_old__066_ = Model.get state__029_ 0
                 and q_new__067_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    ((Lazy.force q_new__067_).closed = true) &&
                      (is_empty_1 q_old__066_.contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "drop_exn"
                      [("q.closed && is_empty (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 186;
                               pos_bol = 8081;
                               pos_cnum = 8102
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 186;
                               pos_bol = 8081;
                               pos_cnum = 8139
                             }
                         })])
           | _ -> None)
      | (Peek_exn, Res ((Result (Int, Exn), _), a_5)) ->
          (match a_5 with
           | Ok a_5 ->
               if
                 let q_old__071_ = Model.get state__029_ 0
                 and q_new__072_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    a_5 =
                      (Ortac_runtime.Gospelstdlib.Sequence.hd
                         (Lazy.force q_new__072_).contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try
                         Ortac_runtime.Report.Protected_value
                           (Res
                              (int,
                                (let q_old__069_ = Model.get state__029_ 0
                                 and q_new__070_ =
                                   lazy
                                     (Model.get (Lazy.force new_state__031_)
                                        0) in
                                 Ortac_runtime.Gospelstdlib.Sequence.hd
                                   (Lazy.force q_new__070_).contents)))
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "peek_exn"
                      [("a = hd q.contents",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 196;
                               pos_bol = 8619;
                               pos_cnum = 8631
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 196;
                               pos_bol = 8619;
                               pos_cnum = 8648
                             }
                         })])
           | Error (Empty) ->
               if
                 let q_old__073_ = Model.get state__029_ 0
                 and q_new__074_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try is_empty_1 (Lazy.force q_new__074_).contents
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Empty"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "peek_exn"
                      [("is_empty q.contents",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 197;
                               pos_bol = 8649;
                               pos_cnum = 8669
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 197;
                               pos_bol = 8649;
                               pos_cnum = 8688
                             }
                         })])
           | Error (Closed) ->
               if
                 let q_old__075_ = Model.get state__029_ 0
                 and q_new__076_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    ((Lazy.force q_new__076_).closed = true) &&
                      (is_empty_1 q_old__075_.contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "peek_exn"
                      [("q.closed && is_empty (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 198;
                               pos_bol = 8689;
                               pos_cnum = 8710
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 198;
                               pos_bol = 8689;
                               pos_cnum = 8747
                             }
                         })])
           | _ -> None)
      | (Peek_opt, Res ((Result (Option (Int), Exn), _), o_1)) ->
          (match o_1 with
           | Ok o_1 ->
               if
                 let q_old__080_ = Model.get state__029_ 0
                 and q_new__081_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try o_1 = (head_safe (Lazy.force q_new__081_).contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try
                         Ortac_runtime.Report.Protected_value
                           (Res
                              ((option int),
                                (let q_old__078_ = Model.get state__029_ 0
                                 and q_new__079_ =
                                   lazy
                                     (Model.get (Lazy.force new_state__031_)
                                        0) in
                                 head_safe (Lazy.force q_new__079_).contents)))
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "peek_opt"
                      [("o = head_safe q.contents",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 206;
                               pos_bol = 9240;
                               pos_cnum = 9252
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 206;
                               pos_bol = 9240;
                               pos_cnum = 9276
                             }
                         })])
           | Error (Closed) ->
               if
                 let q_old__082_ = Model.get state__029_ 0
                 and q_new__083_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    ((Lazy.force q_new__083_).closed = true) &&
                      (is_empty_1 (Lazy.force q_new__083_).contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "peek_opt"
                      [("q.closed && is_empty q.contents",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 207;
                               pos_bol = 9277;
                               pos_cnum = 9298
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 207;
                               pos_bol = 9277;
                               pos_cnum = 9329
                             }
                         })])
           | _ -> None)
      | (Push_head a_3, Res ((Result (Unit, Exn), _), res)) ->
          (match res with
           | Ok _ -> None
           | Error (Closed) ->
               if
                 let q_old__085_ = Model.get state__029_ 0
                 and q_new__086_ =
                   lazy (Model.get (Lazy.force new_state__031_) 0) in
                 (try
                    ((Lazy.force q_new__086_).closed = true) &&
                      (is_empty_1 q_old__085_.contents)
                  with | e -> false)
               then None
               else
                 Some
                   (Ortac_runtime.Report.report "Mpsc_queue_spec" "create ()"
                      (try Ortac_runtime.Report.Exception "Closed"
                       with | e -> Ortac_runtime.Report.Out_of_domain)
                      "push_head"
                      [("q.closed && is_empty (old q.contents)",
                         {
                           Ortac_runtime.start =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 222;
                               pos_bol = 10011;
                               pos_cnum = 10032
                             };
                           Ortac_runtime.stop =
                             {
                               pos_fname = "mpsc_queue_spec.mli";
                               pos_lnum = 222;
                               pos_bol = 10011;
                               pos_cnum = 10069
                             }
                         })])
           | _ -> None)
      | _ -> None
let _ =
  QCheck_base_runner.run_tests_main
    (let count = 500 in
     [STMTests.agree_test ~count ~name:"Mpsc_queue_spec STM tests" 1
        check_init_state ortac_show_cmd ortac_postcond])
